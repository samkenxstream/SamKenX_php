{"id":"spanner\/batch\/batchclient","type":"","title":"Google\\Cloud\\Spanner\\Batch\\BatchClient","name":"BatchClient","description":"<p>Provides Batch APIs used to read data from a Cloud Spanner database.<\/p>\n<p>Batch Clients are useful when one wants to read or query a large amount of\ndata from Cloud Spanner across multiple processes, even across multiple\nmachines. It allows creation of partitions of a Cloud Spanner database in\norder to facilitate reading or querying of each partition independently at\nthe same snapshot.<\/p>","examples":[{"caption":"","code":"use Google\\Cloud\\Spanner\\SpannerClient;\n\n$spanner = new SpannerClient();\n$batch = $spanner->batch('instance-id', 'database-id');"},{"caption":"<p>Using Cloud Pub\/Sub to share partitions with workers<\/p>","code":"use Google\\Cloud\\PubSub\\PubSubClient;\n\n$pubsub = new PubSubClient();\n$topic = $pubsub->topic('partition-queries');\n\n$snapshot = $batch->snapshot();\n\n\/\/ Executing a partition query will return a list of Partitions.\n$partitions = $snapshot->partitionQuery('SELECT * FROM Users WHERE firstName = %%s AND location = %%s', [\n    'parameters' => [\n        'firstName' => 'John',\n        'location' => 'USA'\n    ]\n]);\n\n\/\/ Each partition is published to Cloud Pub\/Sub, where it can be executed by\n\/\/ a worker.\nforeach ($partitions as $partition) {\n    $topic->publish([\n        'attributes' => [\n            'snapshot' => $snapshot->serialize(),\n            'partition' => $partition->serialize()\n        ]\n    ]);\n}\n\n\/\/ Once all workers have finished, we will close the snapshot.\n\/\/ The logic to determine whether the snapshot is no longer needed will vary\n\/\/ and is not implemented here.\ndo {\n    $finished = areWorkersDone();\n\n    if ($finished) {\n        $snapshot->close();\n    }\n} while(!$finished);"},{"caption":"<p>Using Cloud Pub\/Sub to consume a partition and return a result.<\/p>","code":"use Google\\Cloud\\PubSub\\PubSubClient;\n\n$pubsub = new PubSubClient();\n$subscription = $pubsub->subscription('partition-query-consumer');\n\n$messages = $subscription->pull([\n    'returnImmediately' => true,\n    'maxMessages' => 1\n]);\n\nif ($messages) {\n    $message = $messages[0];\n    $snapshot = $batch->snapshotFromString($message->attribute('snapshot'));\n    $partition = $batch->partitionFromString($message->attribute('partition'));\n\n    \/\/ Do something with the query result.\n    processResult($snapshot->executePartition($partition));\n}"}],"resources":[],"methods":[{"id":"__construct","type":"constructor","name":"__construct","source":"Spanner\/src\/Batch\/BatchClient.php#L135","description":"","examples":[],"resources":[],"params":[{"name":"operation","description":"<p>A Cloud Spanner Operations wrapper.<\/p>","types":["<a data-custom-type=\"spanner\/operation\">Google\\Cloud\\Spanner\\Operation<\/a>"],"optional":false,"nullable":null},{"name":"databaseName","description":"<p>The database name to which the batch client\ninstance is scoped.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.string.php\" target=\"_blank\">string<\/a>"],"optional":false,"nullable":null}],"exceptions":[],"returns":[]},{"id":"snapshot","type":"instance","name":"snapshot","source":"Spanner\/src\/Batch\/BatchClient.php#L165","description":"<p>Create a batch snapshot.<\/p>","examples":[{"caption":"","code":"$snapshot = $batch->snapshot();"}],"resources":[],"params":[{"name":"options","description":"<p>Configuration Options<\/p>\n<pre><code>See [ReadOnly](https:\/\/cloud.google.com\/spanner\/reference\/rpc\/google.spanner.v1#google.spanner.v1.TransactionOptions.ReadOnly)\nfor detailed description of available options.<\/code><\/pre>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":true,"nullable":null},{"name":"options.transactionOptions.strong","description":"<p>Read at a timestamp where all previously committed transactions are visible.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.boolean.php\" target=\"_blank\">bool<\/a>"],"optional":null,"nullable":null},{"name":"options.transactionOptions.readTimestamp","description":"<p>Executes all reads at the given timestamp.<\/p>","types":["<a data-custom-type=\"spanner\/timestamp\">Google\\Cloud\\Spanner\\Timestamp<\/a>"],"optional":null,"nullable":null},{"name":"options.transactionOptions.exactStaleness","description":"<p>Represents a number of seconds. Executes all reads at a timestamp that is $exactStaleness old.<\/p>","types":["<a data-custom-type=\"spanner\/duration\">Google\\Cloud\\Spanner\\Duration<\/a>"],"optional":null,"nullable":null},{"name":"options.sessionOptions","description":"<p>Configuration options for session creation.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":null,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"spanner\/batch\/batchsnapshot\">Google\\Cloud\\Spanner\\Batch\\BatchSnapshot<\/a>"],"description":""}]},{"id":"snapshotFromString","type":"instance","name":"snapshotFromString","source":"Spanner\/src\/Batch\/BatchClient.php#L205","description":"<p>Create a <a data-custom-type=\"spanner\/batch\/batchsnapshot\">Google\\Cloud\\Spanner\\Batch\\BatchSnapshot<\/a> from a snapshot\nidentifier.<\/p>\n<p>This method can be used to deserialize a snapshot which is\nshared across multiple servers or processes.<\/p>","examples":[{"caption":"","code":"$snapshot = $batch->snapshotFromString($snapshotString);"}],"resources":[],"params":[{"name":"identifier","description":"<p>A stringified representation of <a data-custom-type=\"spanner\/batch\/batchsnapshot\">Google\\Cloud\\Spanner\\Batch\\BatchSnapshot<\/a>.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.string.php\" target=\"_blank\">string<\/a>"],"optional":false,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"spanner\/batch\/batchsnapshot\">Google\\Cloud\\Spanner\\Batch\\BatchSnapshot<\/a>"],"description":""}]},{"id":"partitionFromString","type":"instance","name":"partitionFromString","source":"Spanner\/src\/Batch\/BatchClient.php#L240","description":"<p>Create a <a data-custom-type=\"spanner\/batch\/partitioninterface\">Google\\Cloud\\Spanner\\Batch\\PartitionInterface<\/a> instance.<\/p>\n<p>This method can be used to deserialize a partition which is\nshared across multiple servers or processes.<\/p>","examples":[{"caption":"","code":"$partition = $batch->partitionFromString($partitionString);"}],"resources":[],"params":[{"name":"partition","description":"<p>Partition data<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.string.php\" target=\"_blank\">string<\/a>"],"optional":false,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"spanner\/batch\/partitioninterface\">Google\\Cloud\\Spanner\\Batch\\PartitionInterface<\/a>"],"description":""}]}]}