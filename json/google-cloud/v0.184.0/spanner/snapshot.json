{"id":"spanner\/snapshot","type":"","title":"Google\\Cloud\\Spanner\\Snapshot","name":"Snapshot","description":"<p>Read-only snapshot Transaction.<\/p>\n<p>For full usage details, please refer to\n<a data-custom-type=\"spanner\/database\" data-method=\"snapshot\">Google\\Cloud\\Spanner\\Database::snapshot()<\/a>.<\/p>","examples":[{"caption":"","code":"use Google\\Cloud\\Spanner\\SpannerClient;\n\n$spanner = new SpannerClient();\n\n$database = $spanner->connect('my-instance', 'my-database');\n$transaction = $database->snapshot();"}],"resources":[],"methods":[{"id":"__construct","type":"constructor","name":"__construct","source":"Spanner\/src\/Snapshot.php#L55","description":"","examples":[],"resources":[],"params":[{"name":"operation","description":"<p>The Operation instance.<\/p>","types":["<a data-custom-type=\"spanner\/operation\">Google\\Cloud\\Spanner\\Operation<\/a>"],"optional":false,"nullable":null},{"name":"session","description":"<p>The session to use for spanner interactions.<\/p>","types":["<a data-custom-type=\"spanner\/session\/session\">Google\\Cloud\\Spanner\\Session\\Session<\/a>"],"optional":false,"nullable":null},{"name":"options","description":"<p>Configuration Options.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":true,"nullable":null},{"name":"options.id","description":"<p>The Transaction ID. If no ID is provided, the Transaction will be a Single-Use Transaction.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.string.php\" target=\"_blank\">string<\/a>"],"optional":null,"nullable":null},{"name":"options.readTimestamp","description":"<p>The read timestamp.<\/p>","types":["<a data-custom-type=\"spanner\/timestamp\">Google\\Cloud\\Spanner\\Timestamp<\/a>"],"optional":null,"nullable":null}],"exceptions":[{"type":"\\InvalidArgumentException","description":"if a tag is specified as this is a read-only transaction."}],"returns":[]},{"id":"readTimestamp","type":"instance","name":"readTimestamp","source":"Spanner\/src\/SnapshotTrait.php#L87","description":"<p>Retrieve the Read Timestamp.<\/p>\n<p>For snapshot read-only transactions, the read timestamp chosen for the\ntransaction.<\/p>\n\nImplemented in <a data-custom-type=\"spanner\/snapshottrait\">Google\\Cloud\\Spanner\\SnapshotTrait<\/a>","examples":[{"caption":"","code":"$timestamp = $snapshot->readTimestamp();"}],"resources":[],"params":[],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"spanner\/timestamp\">Google\\Cloud\\Spanner\\Timestamp<\/a>"],"description":""}]},{"id":"execute","type":"instance","name":"execute","source":"Spanner\/src\/TransactionalReadTrait.php#L265","description":"<p>Run a query.<\/p>\n<p>Google Cloud PHP will infer parameter types for all primitive types and\nall values implementing <a data-custom-type=\"spanner\/valueinterface\">Google\\Cloud\\Spanner\\ValueInterface<\/a>, with\nthe exception of <code>null<\/code>. Non-associative arrays will be interpreted as\na Spanner ARRAY type, and must contain only a single type of value.\nAssociative arrays or values of type <a data-custom-type=\"spanner\/structvalue\">Google\\Cloud\\Spanner\\StructValue<\/a>\nwill be interpreted as Spanner STRUCT type. Structs MUST always explicitly\ndefine their field types.<\/p>\n<p>In any case where the value of a parameter may be <code>null<\/code>, you MUST\nexplicitly define the parameter's type.<\/p>\n<p>With the exception of arrays and structs, types are defined using a type\nconstant defined on <a data-custom-type=\"spanner\/database\">Google\\Cloud\\Spanner\\Database<\/a>. Examples include\nbut are not limited to <code>Database::TYPE_STRING<\/code> and <code>Database::TYPE_INT64<\/code>.<\/p>\n<p>Arrays, when explicitly typing, should use an instance of\n<a data-custom-type=\"spanner\/arraytype\">Google\\Cloud\\Spanner\\ArrayType<\/a> to declare their type and the types\nof any values contained within the array elements.<\/p>\n<p>Structs must always declare their type using an instance of\n<a data-custom-type=\"spanner\/structtype\">Google\\Cloud\\Spanner\\StructType<\/a>. Struct values may be expressed as\nan associative array, however if the struct contains any unnamed fields,\nor any fields with duplicate names, the struct must be expressed using an\ninstance of <a data-custom-type=\"spanner\/structvalue\">Google\\Cloud\\Spanner\\StructValue<\/a>. Struct value types\nmay be inferred with the same caveats as top-level parameters (in other\nwords, so long as they are not nullable and do not contain nested structs).<\/p>\n\nImplemented in <a data-custom-type=\"spanner\/transactionalreadtrait\">Google\\Cloud\\Spanner\\TransactionalReadTrait<\/a>","examples":[{"caption":"","code":"$result = $transaction->execute('SELECT * FROM Posts WHERE ID = @postId', [\n    'parameters' => [\n        'postId' => 1337\n    ]\n]);\n\n$firstRow = $result->rows()->current();"},{"caption":"<p>Parameters which may be null must include an expected parameter type.<\/p>","code":"use Google\\Cloud\\Spanner\\Database;\nuse Google\\Cloud\\Spanner\\Timestamp;\n\n$values = [\n    new Timestamp(new \\DateTimeImmutable),\n    null\n];\n\n$result = $transaction->execute('SELECT @timestamp as timestamp', [\n    'parameters' => [\n        'timestamp' => array_rand($values)\n    ],\n    'types' => [\n        'timestamp' => Database::TYPE_TIMESTAMP\n    ]\n]);\n\n$timestamp = $result->rows()->current()['timestamp'];"},{"caption":"<p>Array parameters which may be null or empty must include the array value type.<\/p>","code":"use Google\\Cloud\\Spanner\\ArrayType;\nuse Google\\Cloud\\Spanner\\Database;\n\n$result = $transaction->execute('SELECT @emptyArrayOfIntegers as numbers', [\n    'parameters' => [\n        'emptyArrayOfIntegers' => []\n    ],\n    'types' => [\n        'emptyArrayOfIntegers' => new ArrayType(Database::TYPE_INT64)\n    ]\n]);\n\n$row = $result->rows()->current();\n$emptyArray = $row['numbers'];"},{"caption":"<p>Struct parameters provide a type definition. Fields within a Struct may be inferred following the same rules as top-level parameters. Any nested structs must be an instance of <code>Google\\Cloud\\Spanner\\StructType<\/code>, and any values which could be of type <code>null<\/code> must explicitly specify their type.<\/p>","code":"use Google\\Cloud\\Spanner\\Database;\nuse Google\\Cloud\\Spanner\\StructType;\n\n$result = $transaction->execute('SELECT @userStruct.firstName, @userStruct.lastName', [\n    'parameters' => [\n        'userStruct' => [\n            'firstName' => 'John',\n            'lastName' => 'Testuser'\n        ]\n    ],\n    'types' => [\n        'userStruct' => (new StructType())\n            ->add('firstName', Database::TYPE_STRING)\n            ->add('lastName', Database::TYPE_STRING)\n    ]\n]);\n\n$row = $result->rows()->current();\n$fullName = $row['firstName'] . ' ' . $row['lastName']; \/\/ `John Testuser`"},{"caption":"<p>If a struct contains unnamed fields, or multiple fields with the same name, it must be defined using <a data-custom-type=\"spanner\/structvalue\">Google\\Cloud\\Spanner\\StructValue<\/a>.<\/p>","code":"use Google\\Cloud\\Spanner\\Database;\nuse Google\\Cloud\\Spanner\\Result;\nuse Google\\Cloud\\Spanner\\StructValue;\nuse Google\\Cloud\\Spanner\\StructType;\n\n$res = $transaction->execute('SELECT * FROM UNNEST(ARRAY(SELECT @structParam))', [\n    'parameters' => [\n        'structParam' => (new StructValue)\n            ->add('foo', 'bar')\n            ->add('foo', 2)\n            ->addUnnamed('this field is unnamed')\n    ],\n    'types' => [\n        'structParam' => (new StructType)\n            ->add('foo', Database::TYPE_STRING)\n            ->add('foo', Database::TYPE_INT64)\n            ->addUnnamed(Database::TYPE_STRING)\n    ]\n])->rows(Result::RETURN_NAME_VALUE_PAIR)->current();\n\necho $res[0]['name'] . ': ' . $res[0]['value'] . PHP_EOL; \/\/ \"foo: bar\"\necho $res[1]['name'] . ': ' . $res[1]['value'] . PHP_EOL; \/\/ \"foo: 2\"\necho $res[2]['name'] . ': ' . $res[2]['value'] . PHP_EOL; \/\/ \"2: this field is unnamed\""}],"resources":[{"title":"ExecuteStreamingSqlRequest","link":"https:\/\/cloud.google.com\/spanner\/reference\/rpc\/google.spanner.v1#google.spanner.v1.ExecuteStreamingSqlRequest"}],"params":[{"name":"sql","description":"<p>The query string to execute.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.string.php\" target=\"_blank\">string<\/a>"],"optional":false,"nullable":null},{"name":"options","description":"<p>Configuration Options.\nSee <a href=\"https:\/\/cloud.google.com\/spanner\/docs\/reference\/rpc\/google.spanner.v1#google.spanner.v1.TransactionOptions\">TransactionOptions<\/a>\nfor detailed description of available transaction options. Please\nnote that only one of <code>$strong<\/code>, <code>$minReadTimestamp<\/code>,\n<code>$maxStaleness<\/code>, <code>$readTimestamp<\/code> or <code>$exactStaleness<\/code> may be set in\na request.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":true,"nullable":null},{"name":"options.parameters","description":"<p>A key\/value array of Query Parameters, where the key is represented in the query string prefixed by a <code>@<\/code> symbol.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":null,"nullable":null},{"name":"options.types","description":"<p>A key\/value array of Query Parameter types. Generally, Google Cloud PHP can infer types. Explicit type declarations are required in the case of struct parameters, or when a null value exists as a parameter. Accepted values for primitive types are defined as constants on <a data-custom-type=\"spanner\/database\">Google\\Cloud\\Spanner\\Database<\/a>, and are as follows: <code>Database::TYPE_BOOL<\/code>, <code>Database::TYPE_INT64<\/code>, <code>Database::TYPE_FLOAT64<\/code>, <code>Database::TYPE_TIMESTAMP<\/code>, <code>Database::TYPE_DATE<\/code>, <code>Database::TYPE_STRING<\/code>, <code>Database::TYPE_BYTES<\/code>. If the value is an array, use <a data-custom-type=\"spanner\/arraytype\">Google\\Cloud\\Spanner\\ArrayType<\/a> to declare the array parameter types. Likewise, for structs, use <a data-custom-type=\"spanner\/structtype\">Google\\Cloud\\Spanner\\StructType<\/a>.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":null,"nullable":null},{"name":"options.queryOptions","description":"<p>Query optimizer configuration.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":null,"nullable":null},{"name":"options.queryOptions.optimizerVersion","description":"<p>An option to control the selection of optimizer version. This parameter allows individual queries to pick different query optimizer versions. Specifying &quot;latest&quot; as a value instructs Cloud Spanner to use the latest supported query optimizer version. If not specified, Cloud Spanner uses optimizer version set at the client level options or set by the <code>SPANNER_OPTIMIZER_VERSION<\/code> environment variable. Any other positive integer (from the list of supported optimizer versions) overrides the default optimizer version for query execution. Executing a SQL statement with an invalid optimizer version will fail with a syntax error (<code>INVALID_ARGUMENT<\/code>) status.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.string.php\" target=\"_blank\">string<\/a>"],"optional":null,"nullable":null},{"name":"options.requestOptions","description":"<p>Request options. For more information on available options, please see <a href=\"https:\/\/cloud.google.com\/spanner\/docs\/reference\/rest\/v1\/RequestOptions\">the upstream documentation<\/a>. Please note, if using the <code>priority<\/code> setting you may utilize the constants available on <a data-custom-type=\"spanner\/v1\/requestoptions\/priority\">Google\\Cloud\\Spanner\\V1\\RequestOptions\\Priority<\/a> to set a value. Please note, the <code>transactionTag<\/code> setting will be ignored as the transaction tag should have already been set when creating the transaction.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":null,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"spanner\/result\">Google\\Cloud\\Spanner\\Result<\/a>"],"description":""}]},{"id":"read","type":"instance","name":"read","source":"Spanner\/src\/TransactionalReadTrait.php#L328","description":"<p>Lookup rows in a table.<\/p>\n\nImplemented in <a data-custom-type=\"spanner\/transactionalreadtrait\">Google\\Cloud\\Spanner\\TransactionalReadTrait<\/a>","examples":[{"caption":"","code":"use Google\\Cloud\\Spanner\\KeySet;\n\n$keySet = new KeySet([\n    'keys' => [1337]\n]);\n\n$columns = ['ID', 'title', 'content'];\n\n$result = $transaction->read('Posts', $keySet, $columns);\n\n$firstRow = $result->rows()->current();"}],"resources":[{"title":"ReadRequest","link":"https:\/\/cloud.google.com\/spanner\/reference\/rpc\/google.spanner.v1#google.spanner.v1.ReadRequest"}],"params":[{"name":"table","description":"<p>The table name.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.string.php\" target=\"_blank\">string<\/a>"],"optional":false,"nullable":null},{"name":"keySet","description":"<p>The KeySet to select rows.<\/p>","types":["<a data-custom-type=\"spanner\/keyset\">Google\\Cloud\\Spanner\\KeySet<\/a>"],"optional":false,"nullable":null},{"name":"columns","description":"<p>A list of column names to return.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":false,"nullable":null},{"name":"options","description":"<p>Configuration Options.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":true,"nullable":null},{"name":"options.index","description":"<p>The name of an index on the table.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.string.php\" target=\"_blank\">string<\/a>"],"optional":null,"nullable":null},{"name":"options.limit","description":"<p>The number of results to return.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.integer.php\" target=\"_blank\">int<\/a>"],"optional":null,"nullable":null},{"name":"options.requestOptions","description":"<p>Request options. For more information on available options, please see <a href=\"https:\/\/cloud.google.com\/spanner\/docs\/reference\/rest\/v1\/RequestOptions\">the upstream documentation<\/a>. Please note, if using the <code>priority<\/code> setting you may utilize the constants available on <a data-custom-type=\"spanner\/v1\/requestoptions\/priority\">Google\\Cloud\\Spanner\\V1\\RequestOptions\\Priority<\/a> to set a value. Please note, the <code>transactionTag<\/code> setting will be ignored as the transaction tag should have already been set when creating the transaction.<\/p>","types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.array.php\" target=\"_blank\">array<\/a>"],"optional":null,"nullable":null}],"exceptions":[],"returns":[{"types":["<a data-custom-type=\"spanner\/result\">Google\\Cloud\\Spanner\\Result<\/a>"],"description":""}]},{"id":"id","type":"instance","name":"id","source":"Spanner\/src\/TransactionalReadTrait.php#L361","description":"<p>Retrieve the Transaction ID.<\/p>\n\nImplemented in <a data-custom-type=\"spanner\/transactionalreadtrait\">Google\\Cloud\\Spanner\\TransactionalReadTrait<\/a>","examples":[{"caption":"","code":"$id = $transaction->id();"}],"resources":[],"params":[],"exceptions":[],"returns":[{"types":["<a href=\"http:\/\/php.net\/manual\/en\/language.types.string.php\" target=\"_blank\">string<\/a>","<a href=\"http:\/\/php.net\/manual\/en\/language.types.null.php\" target=\"_blank\">null<\/a>"],"description":""}]}]}